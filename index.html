<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <!-- 
      CRÍTICO para diseño responsive en móviles: 
      Evita el zoom y bloquea la escalabilidad del usuario para
      mantener el control total de la UI del libro.
    -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Libro Álbum Pedagógico | Interactivo</title>
   
    <!-- Carga de Tailwind CSS (Framework de UI) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 
      Carga de Fuentes:
      - Cinzel: Serif elegante para títulos (Créditos, Dedicatoria).
      - Lora: Serif legible para texto (Modal).
      - Montserrat: Sans-serif moderna para texto secundario (Créditos).
    -->
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,600;1,400&family=Montserrat:wght@300;400;500;700&family=Cinzel:wght@700&display=swap" rel="stylesheet">
    
    <!-- Carga de Phosphor Icons (para los botones de control) -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <!-- Librería PageFlip para el efecto 3D de pasar página -->
    <script src="https://cdn.jsdelivr.net/npm/page-flip/dist/js/page-flip.browser.js"></script>

    <style>
        /* --- ESTILOS GENERALES Y TEXTURAS --- */
        :root {
            /* Textura de papel sutil para páginas interiores */
            --paper-texture: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
            /* Textura más rugosa para las guardas (NUEVA) */
            --guard-texture: url("https://www.transparenttextures.com/patterns/light-sketch.png");
        }

        body {
            /* Fondo oscuro del "escritorio" para resaltar el libro */
            background-color: #1e293b; 
            background-image: radial-gradient(#334155 1px, transparent 1px);
            background-size: 32px 32px;
            font-family: 'Lora', serif; /* Fuente por defecto del libro */
            margin: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden; /* CRÍTICO: Evita el scroll del navegador */
            display: flex;
            flex-direction: column;
        }

        /* WRAPPER PRINCIPAL: Centra el libro y reserva espacio para controles */
        .wrapper {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            position: relative;
            perspective: 1500px;
            padding-bottom: 60px; /* Espacio para la barra de control inferior */
        }

        /* EL LIBRO (Contenedor de PageFlip) */
        .stf__wrapper {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* --- ESTILOS DE PÁGINA --- */

        /* Estilo base de todas las páginas */
        .page {
            background-color: #fcf8f3; 
            background-image: var(--paper-texture);
            border: 1px solid #cbd5e1;
            overflow: hidden;
            background-size: cover;
            background-position: center;
        }

        /* Sombreado del lomo para dar profundidad */
        .page.-left { border-right: none; box-shadow: inset -10px 0 20px -10px rgba(0,0,0,0.2); }
        .page.-right { border-left: none; box-shadow: inset 10px 0 20px -10px rgba(0,0,0,0.2); }

        /* Estilos de Páginas Duras (Tapa y Contratapa) */
        .hard {
            background-color: #f1f5f9; /* Color base si la imagen no carga */
            border: solid 1px #94a3b8;
        }

        /* Contenido de la Página (Default)
          IMPORTANTE: Sin padding por defecto para permitir imágenes full-bleed.
        */
        .page-content {
            width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            position: relative; /* Clave para posicionar el hotspot */
            padding: 0; /* Sin padding por defecto */
        }
        
        /* --- ESTILOS DE PÁGINAS ESPECÍFICOS (DIAGRAMACIÓN PROFESIONAL) --- */
        
        /* 1. Créditos (Legal) - AJUSTADO */
        .page-content.legal-page {
            font-family: 'Montserrat', sans-serif;
            justify-content: center;
            align-items: center;
            padding: 2rem 1.5rem;
        }
        .legal-box {
            width: 100%;
            max-width: 320px; /* Ancho de columna de texto (Ajustado) */
        }
        .legal-box h2 {
            font-family: 'Cinzel', serif;
            font-weight: 700;
            font-size: 1.25rem; /* 20px (Ajustado) */
            color: #1e293b;
            border-bottom: 1px solid #cbd5e1;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
            letter-spacing: 0.05em; /* Espaciado de letra elegante */
        }
        .legal-box p {
            font-size: 0.8rem; /* 13px (Ajustado para 'fine print') */
            line-height: 1.65; /* (Ajustado) */
            color: #475569;
            white-space: pre-line; /* Respeta los saltos de línea del JS */
        }
        
        /* 2. Dedicatoria - AJUSTADO */
        .page-content.dedication-page {
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 4rem 3rem; /* Más "aire" (Ajustado) */
        }
        .dedication-page p {
            font-family: 'Lora', serif;
            font-style: italic;
            font-size: 1.125rem; /* 18px */
            color: #334155;
            max-width: 350px;
            line-height: 1.8; /* Más interlineado (Ajustado) */
        }
        
        /* 3. Guardas (Endpapers) - AJUSTADO */
        .page-content.guard-page {
            background-color: #e0e7ff; /* Color lila pálido */
            background-image: var(--guard-texture); /* Nueva textura */
            opacity: 0.8; /* (Ajustado) */
        }
        
        /* 4. Contraportada (Reflexión) - AJUSTADO */
        .reflection-box {
            position: absolute;
            bottom: 1.5rem;
            left: 1.5rem;
            right: 1.5rem;
            background: rgba(0, 0, 0, 0.5); /* Más sutil */
            backdrop-filter: blur(8px); /* Más desenfoque */
            padding: 1rem 1.25rem;
            border-radius: 8px;
            color: #f1f5f9;
            font-style: italic;
            font-size: 0.875rem; /* 14px */
            line-height: 1.6;
        }
        
        /* --- HOTSPOT PEDAGÓGICO (El ícono llamativo) --- */

        /* Contenedor del hotspot (para el 'group-hover') */
        .pedagogical-container {
            position: absolute;
            z-index: 50;
            top: 1rem; /* 16px */
            right: 1rem; /* 16px */
            /* 'group' se añade vía JS/HTML */
        }

        .pedagogical-btn {
            /* Ya no necesita position: absolute */
            position: relative;
            z-index: 2; /* Para estar sobre la animación */
            width: 40px;
            height: 40px;
            background-color: #06b6d4; /* Color Cian (Llamativo) */
            color: white;
            border: 2px solid white;
            border-radius: 50%;
            font-size: 1.5rem; /* 24px */
            font-weight: 700;
            font-family: 'Montserrat', sans-serif;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            
            /* Centrado del icono (?) */
            display: flex;
            align-items: center;
            justify-content: center;
            
            cursor: pointer;
            transition: transform 0.2s ease-out;
            
            /* Animación de Pulso (Llamativo) */
            box-shadow: 0 0 20px 5px rgba(6, 182, 212, 0.5);
            animation: pulse-cyan 2s infinite cubic-bezier(0.66, 0, 0, 1);
        }
        
        .pedagogical-btn:hover {
            transform: scale(1.15);
        }

        /* El Tooltip (se muestra en hover) */
        .pedagogical-tooltip {
            position: absolute;
            bottom: 110%; /* Encima del botón */
            right: 0;
            
            background-color: #1e293b; /* Color oscuro */
            color: white;
            padding: 0.5rem 0.75rem; /* 8px 12px */
            border-radius: 6px;
            font-family: 'Montserrat', sans-serif;
            font-size: 0.875rem; /* 14px */
            font-weight: 500;
            white-space: nowrap; /* Para que no se parta el título */
            
            /* Oculto por defecto */
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px); /* Sube al aparecer */
            transition: all 0.2s ease-out;
            pointer-events: none; /* No interfiere con el clic */
        }
        
        /* Mostrar en hover (usando 'group-hover' del div contenedor) */
        .group:hover .pedagogical-tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        /* Animación del Hotspot */
        @keyframes pulse-cyan {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(6, 182, 212, 0.7);
            }
            70% {
                transform: scale(1);
                box-shadow: 0 0 0 15px rgba(6, 182, 212, 0);
            }
            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(6, 182, 212, 0);
            }
        }
        
        /* --- MODAL PEDAGÓGICO (Ventana de explicación) --- */
        #pedagogicalModal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(8px);
            z-index: 2000;
            display: none; /* Oculto por defecto */
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 1.5rem 2rem;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            border-top: 5px solid #06b6d4; /* Acento cian */
        }
        .modal-content h2 {
            font-family: 'Cinzel', serif;
            font-size: 1.75rem; /* 28px */
            color: #1e293b;
            margin-bottom: 0.75rem;
        }
        .modal-content p {
            font-family: 'Lora', serif;
            font-size: 1rem; /* 16px */
            color: #334155;
            line-height: 1.7;
            margin-bottom: 1.5rem;
        }
        .modal-content button {
            width: 100%;
            background: #334155;
            color: white;
            padding: 0.75rem;
            border-radius: 8px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            transition: background 0.2s;
        }
        .modal-content button:hover {
            background: #1e293b;
        }


        /* --- CONTROLES DE NAVEGACIÓN --- */
        .controls-bar {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            display: flex;
            gap: 1rem;
            align-items: center;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            padding: 0.5rem 1.5rem;
            border-radius: 99px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>

    <!-- 1. El Libro (Contenedor HTML vacío que llenará JS) -->
    <div class="wrapper">
        <div id="book">
            <!-- Las páginas se generan aquí por JavaScript -->
        </div>
    </div>

    <!-- 2. Barra de Controles (Navegación) -->
    <div class="controls-bar">
        <button onclick="flipPrev()" class="p-2 rounded-full hover:bg-gray-200 transition"><i class="ph-bold ph-caret-left text-xl text-gray-800"></i></button>
        <span id="pageIndicator" class="text-xs font-bold text-gray-500 uppercase tracking-widest w-24 text-center">Portada</span>
        <button onclick="flipNext()" class="p-2 rounded-full hover:bg-gray-200 transition"><i class="ph-bold ph-caret-right text-xl text-gray-800"></i></button>
    </div>

    <!-- 3. Modal de Inicio (Bienvenida) -->
    <div id="startModal" class="fixed inset-0 bg-black/80 z-[2000] flex items-center justify-center p-4">
        <div class="bg-white rounded-lg p-6 max-w-sm w-full text-center shadow-2xl">
            <h2 class="text-3xl font-serif font-bold mb-2 text-slate-800" style="font-family: 'Cinzel', serif;">Libro Álbum</h2>
            <p class="text-sm text-gray-600 mb-6">Una experiencia pedagógica interactiva.</p>
            <button onclick="startExperience()" class="w-full bg-cyan-600 text-white py-2 rounded font-bold hover:bg-cyan-700 transition">Comenzar</button>
        </div>
    </div>
    
    <!-- 4. Modal Pedagógico (Oculto por defecto) -->
    <div id="pedagogicalModal">
        <div class="modal-content">
            <h2 id="modalTitle">Título de la Sección</h2>
            <p id="modalText">Explicación de la parte del libro...</p>
            <button id="closeModalBtn">Entendido</button>
        </div>
    </div>

    <script>
        let pageFlip; // Variable global para el objeto del libro
        
        // --- URL DE LA IMAGEN DE FONDO (AJUSTADA) ---
        // Aquí puedes cambiar la imagen de fondo para todas las páginas
        const PLACEHOLDER_IMG_URL = 'https://lh3.googleusercontent.com/proxy/oZ84KkPQtrG4pDjqUMIa1G_-fZfzNOZknL8Q7rYcu-Ewg7QeRTodBBC0VAyGC8N6IvHWCIIABbtZ_HhqTa2QhDPVpN_XFn08g5O3obQLYACJsJjxqbau8GTLOHyqCnLxKtbilPMuPG8J5A';
        
        
        // --- 1. CONTENIDO DEL LIBRO (La "Fuente de Verdad") ---
        // Textos pedagógicos actualizados
        const bookContent = [
            // 1. Portada
            { 
                type: 'cover', 
                img: PLACEHOLDER_IMG_URL, 
                hotspot: {
                    title: 'La Portada',
                    text: 'Es la "cara" del libro. Debe incluir el título y el nombre del autor e ilustrador. La imagen es lo más importante, ya que nos da una pista sobre la historia.'
                }
            },
            
            // 2. Guardas (Inicio)
            { 
                type: 'guard',
                hotspot: {
                    title: 'Las Guardas',
                    text: 'Son las páginas que unen la tapa dura con el interior. Su función es proteger el libro. A veces tienen colores o ilustraciones que nos introducen al mundo de la historia.'
                }
            },
            
            // 3. Página de Respeto (Simple)
            { type: 'respect' },
            
            // 4. Créditos
            { 
                type: 'legal', 
                title: 'Créditos Editoriales',
                text: 'Ilustraciones: Artista Ejemplo\nHistoria: Escritor Ejemplo\nDiseño: Tu Nombre Aquí\nPublicado por: Editorial Creativa, 2025\nHecho en Colombia\nISBN: 978-0-00-000000-0',
                hotspot: {
                    title: 'Página de Créditos',
                    text: 'Aquí se lista quiénes hicieron el libro (autor, ilustrador, editorial) y la información legal, como el año de publicación y el ISBN (un código único del libro).'
                }
            },
            
            // 5. Dedicatoria
            { 
                type: 'dedication', 
                text: 'A todos los que se atreven a soñar con mundos dibujados.',
                hotspot: {
                    title: 'La Dedicatoria',
                    text: 'Es un breve texto, usualmente en una página propia, donde el autor o ilustrador le ofrece su obra a una persona o grupo especial en su vida.'
                }
            },
            
            // --- 6 a 19. Cuerpo del Libro (14 páginas) ---
            // Generamos 14 páginas de cuerpo.
            ...Array.from({ length: 14 }, (v, i) => ({
                type: 'body',
                img: `${PLACEHOLDER_IMG_URL},${i}`, // Añadimos el índice para variar la imagen de Unsplash
                // El hotspot solo se añade a la PRIMERA página del cuerpo
                hotspot: i === 0 ? { 
                    title: 'Páginas de Cuerpo',
                    text: 'Es donde la historia se desarrolla. En un libro álbum, la ilustración es la protagonista y debe ocupar la mayor parte del espacio, contando la historia visualmente.'
                } : null
            })),

            // 20. Guardas (Final)
            { type: 'guard' },
            
            // 21. Contraportada
            { 
                type: 'cover-back', 
                img: PLACEHOLDER_IMG_URL, // Usa la misma imagen base
                reflection: 'Las mejores historias no terminan en la última página, sino que comienzan en tu imaginación.',
                hotspot: {
                    title: 'La Contraportada',
                    text: 'Es la parte de atrás del libro. Usualmente tiene un breve resumen de la historia (sinopsis), una ilustración final, o la información de la editorial y el código de barras.'
                }
            }
        ];

        // --- 2. FUNCIONES DEL LIBRO ---

        function startExperience() {
            document.getElementById('startModal').style.display = 'none';
            initBook();
        }

        // Calcula las dimensiones óptimas del libro para la pantalla
        function calculateBookDimensions() {
            const wrapper = document.querySelector('.wrapper');
            const winWidth = wrapper.clientWidth;
            const winHeight = wrapper.clientHeight;

            const verticalMargin = 60; // Margen vertical total (arriba/abajo)
            const horizontalMargin = 40; // Margen lateral total

            const availableHeight = winHeight - verticalMargin;
            const availableWidth = winWidth - horizontalMargin;

            // Relación de aspecto de una página de libro álbum (más vertical)
            const aspectRatio = 0.75; // Ancho / Alto (Ej: 800 ancho / 1066 alto)

            let bookHeight = availableHeight;
            let bookWidth = bookHeight * aspectRatio;

            const isMobile = winWidth < 768;
            const pagesVisible = isMobile ? 1 : 2;

            if ((bookWidth * pagesVisible) > availableWidth) {
                bookWidth = availableWidth / pagesVisible;
                bookHeight = bookWidth / aspectRatio;
            }

            return { width: Math.floor(bookWidth), height: Math.floor(bookHeight) };
        }

        // Inicializa el libro: genera el HTML y carga PageFlip
        function initBook() {
            const bookEl = document.getElementById('book');
           
            // 1. Generar HTML del libro desde el array `bookContent`
            let html = bookContent.map((page, i) => {
                let content = '';
                let pageClasses = 'page';
                let contentClasses = 'page-content';
                let style = '';
                // Fallback de color por si la imagen falla
                let fallbackStyle = 'background-color: #f1f5f9;'; 

                // Asignar clases de Tapa Dura
                if (page.type === 'cover' || page.type === 'cover-back') {
                    pageClasses += ' hard';
                }

                // Renderizar contenido según el tipo de página
                switch (page.type) {
                    case 'cover':
                    case 'body':
                        style = `background-image: url('${page.img}'); ${fallbackStyle}`;
                        break;
                    case 'cover-back':
                        style = `background-image: url('${page.img}'); ${fallbackStyle}`;
                        content = `<div class="reflection-box">${page.reflection}</div>`;
                        break;
                    case 'guard':
                        contentClasses += ' guard-page';
                        break;
                    case 'respect':
                        contentClasses += ' bg-gray-50'; // Página en blanco simple
                        break;
                    case 'legal':
                        contentClasses += ' legal-page';
                        content = `<div class="legal-box">
                                       <h2>${page.title}</h2>
                                       <p>${page.text}</p>
                                   </div>`;
                        break;
                    case 'dedication':
                        contentClasses += ' dedication-page';
                        content = `<p>${page.text}</p>`;
                        break;
                }
                
                // Añadir el Hotspot Pedagógico si existe en la página
                if (page.hotspot) {
                    content += renderHotspot(page.hotspot);
                }

                return `<div class="${pageClasses}" style="${style}">
                            <div class="${contentClasses}">${content}</div>
                        </div>`;
            }).join('');
           
            bookEl.innerHTML = html;

            // 2. Calcular dimensiones e inicializar PageFlip
            const dims = calculateBookDimensions();
           
            pageFlip = new St.PageFlip(bookEl, {
                width: dims.width,
                height: dims.height,
                size: 'fixed', // Usamos 'fixed' porque calculamos nosotros el tamaño
                minWidth: 200, maxWidth: 1200,
                minHeight: 300, maxHeight: 1600,
                maxShadowOpacity: 0.5,
                showCover: true,
                mobileScrollSupport: false // Desactivamos scroll para usar el gesto de flip
            });

            pageFlip.loadFromHTML(document.querySelectorAll('.page'));

            // 3. Añadir Listeners (eventos)
            pageFlip.on('flip', (e) => {
                updatePageIndicator(e.data);
            });
            
            // Actualizar indicador al inicio
            updatePageIndicator(0);
            
            // **CORRECCIÓN:** Conectar botones del modal y hotspots
            attachModalListeners(); 

        } // <-- Esta es la llave que faltaba en la versión anterior.

        // --- 3. FUNCIONES DE HOTSPOT Y MODAL (REFACTORIZADAS) ---
        
        // Genera el HTML para el botón del hotspot y el tooltip
        function renderHotspot(hotspot) {
            // **CORRECCIÓN:** Escapar las comillas para atributos HTML
            const safeTitle = hotspot.title.replace(/'/g, "&apos;").replace(/"/g, "&quot;");
            const safeText = hotspot.text.replace(/'/g, "&apos;").replace(/"/g, "&quot;");
            
            // Contenedor 'group' para el hover
            return `<div class="pedagogical-container group">
                        
                        <!-- El Tooltip (se muestra en hover) -->
                        <span class="pedagogical-tooltip">${hotspot.title}</span>
                        
                        <!-- El Botón (ahora usa data-attributes) -->
                        <button 
                            class="pedagogical-btn" 
                            data-title="${safeTitle}"
                            data-text="${safeText}"
                        >?</button>
                    </div>`;
        }
        
        /** * **NUEVA FUNCIÓN**
         * Asigna todos los listeners para los modales.
         * Se llama 1 sola vez después de que se crea el HTML del libro.
         */
        function attachModalListeners() {
            // 1. Asignar listener a CADA botón pedagógico
            document.querySelectorAll('.pedagogical-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const title = btn.getAttribute('data-title');
                    const text = btn.getAttribute('data-text');
                    showPedagogicalModal(title, text);
                });
            });

            // 2. Asignar listener al botón de "Cerrar" del modal
            document.getElementById('closeModalBtn').addEventListener('click', hidePedagogicalModal);
            
            // 3. Asignar listener para cerrar el modal al hacer clic fuera
            document.getElementById('pedagogicalModal').addEventListener('click', (e) => {
                if (e.target.id === 'pedagogicalModal') {
                    hidePedagogicalModal();
                }
            });
        }
        
        // Muestra el modal con el contenido pedagógico
        function showPedagogicalModal(title, text) {
            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalText').innerText = text;
            document.getElementById('pedagogicalModal').style.display = 'flex';
        }
        
        // Oculta el modal
        function hidePedagogicalModal() {
            document.getElementById('pedagogicalModal').style.display = 'none';
        }

        // --- 4. FUNCIONES DE NAVEGACIÓN (UI) ---

        function flipNext() { if (pageFlip) pageFlip.flipNext(); }
        function flipPrev() { if (pageFlip) pageFlip.flipPrev(); }
        
        // Actualiza el texto del indicador de página (Ej: "Pág 2-3")
        function updatePageIndicator(currentPage) {
            const indicator = document.getElementById('pageIndicator');
            if (!pageFlip) return; // Chequeo de seguridad
            
            const total = pageFlip.getPageCount();
            
            if (currentPage === 0) {
                indicator.innerText = 'Portada';
            } else if (currentPage >= total - 1) { // Contraportada
                indicator.innerText = 'Final';
            } else {
                // Detectamos si es vista móvil o si la librería se configuró para una sola página
                const settings = pageFlip.getSettings();
                const isMobileView = window.innerWidth < 768 || (settings.width < settings.maxWidth / 1.5);
                
                if (isMobileView || currentPage === 1) { // Vista móvil o las primeras páginas
                    indicator.innerText = `Pág ${currentPage}`;
                } else {
                    // En Desktop (modo spread)
                    let left, right;
                    if (currentPage % 2 === 0) { // Página derecha (2, 4, ...)
                        left = currentPage - 1;
                        right = currentPage;
                    } else { // Página izquierda (3, 5, ...)
                        left = currentPage;
                        right = currentPage + 1;
                    }
                    
                    indicator.innerText = `Pág ${left}-${right}`;
                }
            }
        }

        // --- 5. MANEJO DE REDIMENSIONAMIENTO DE VENTANA ---
        
        // Recalcular si se redimensiona la ventana (ej: girar el móvil)
        let resizeTimeout;
        window.onresize = () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                if (pageFlip) {
                    // Destruimos la instancia anterior y la creamos de nuevo
                    // con las nuevas dimensiones.
                    pageFlip.destroy();
                    initBook(); 
                }
            }, 300); // Espera 300ms antes de recalcular
        };

    </script>
</body>
</html>
