<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <!-- 
      CRÍTICO para diseño responsive en móviles: 
      Evita el zoom y bloquea la escalabilidad del usuario para
      mantener el control total de la UI del libro.
    -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Libro Álbum Pedagógico | Interactivo</title>
   
    <!-- Carga de Tailwind CSS (Framework de UI) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 
      Carga de Fuentes:
      - Cinzel: Serif elegante para títulos (Créditos, Dedicatoria).
      - Lora: Serif legible para texto (Modal).
      - Montserrat: Sans-serif moderna para texto secundario (Créditos).
    -->
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,600;1,400&family=Montserrat:wght@300;400;500;700&family=Cinzel:wght@700&display=swap" rel="stylesheet">
    
    <!-- Carga de Phosphor Icons (para los botones de control) -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <!-- Librería PageFlip para el efecto 3D de pasar página -->
    <script src="https://cdn.jsdelivr.net/npm/page-flip/dist/js/page-flip.browser.js"></script>

    <style>
        /* --- ESTILOS GENERALES Y TEXTURAS --- */
        :root {
            /* Textura de papel sutil para páginas interiores */
            --paper-texture: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
            /* Textura más rugosa para las guardas */
            --guard-texture: url("https://www.transparenttextures.com/patterns/dust-scratches.png");
        }

        body {
            /* Fondo oscuro del "escritorio" para resaltar el libro */
            background-color: #1e293b; 
            background-image: radial-gradient(#334155 1px, transparent 1px);
            background-size: 32px 32px;
            font-family: 'Lora', serif; /* Fuente por defecto del libro */
            margin: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden; /* CRÍTICO: Evita el scroll del navegador */
            display: flex;
            flex-direction: column;
        }

        /* WRAPPER PRINCIPAL: Centra el libro y reserva espacio para controles */
        .wrapper {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            position: relative;
            perspective: 1500px;
            padding-bottom: 60px; /* Espacio para la barra de control inferior */
        }

        /* EL LIBRO (Contenedor de PageFlip) */
        .stf__wrapper {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* --- ESTILOS DE PÁGINA --- */

        /* Estilo base de todas las páginas */
        .page {
            background-color: #fcf8f3; 
            background-image: var(--paper-texture);
            border: 1px solid #cbd5e1;
            overflow: hidden;
            background-size: cover;
            background-position: center;
        }

        /* Sombreado del lomo para dar profundidad */
        .page.-left { border-right: none; box-shadow: inset -10px 0 20px -10px rgba(0,0,0,0.2); }
        .page.-right { border-left: none; box-shadow: inset 10px 0 20px -10px rgba(0,0,0,0.2); }

        /* Estilos de Páginas Duras (Tapa y Contratapa) */
        .hard {
            background-color: #f1f5f9; /* Color base si la imagen no carga */
            border: solid 1px #94a3b8;
        }

        /* Contenido de la Página (Default)
          IMPORTANTE: Sin padding por defecto para permitir imágenes full-bleed.
        */
        .page-content {
            width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            position: relative; /* Clave para posicionar el hotspot */
            padding: 0; /* Sin padding por defecto */
        }
        
        /* --- ESTILOS DE PÁGINAS ESPECÍFICOS (DIAGRAMACIÓN) --- */
        
        /* 1. Créditos (Legal) */
        .page-content.legal-page {
            font-family: 'Montserrat', sans-serif;
            justify-content: center;
            align-items: center;
            padding: 2rem 1.5rem;
        }
        .legal-box {
            width: 100%;
            max-width: 300px; /* Ancho de columna de texto */
        }
        .legal-box h2 {
            font-family: 'Cinzel', serif;
            font-weight: 700;
            font-size: 1.5rem; /* 24px */
            color: #1e293b;
            border-bottom: 1px solid #cbd5e1;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }
        .legal-box p {
            font-size: 0.75rem; /* 12px */
            line-height: 1.6;
            color: #475569;
            white-space: pre-line; /* Respeta los saltos de línea del JS */
        }
        
        /* 2. Dedicatoria */
        .page-content.dedication-page {
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 3rem;
        }
        .dedication-page p {
            font-family: 'Lora', serif;
            font-style: italic;
            font-size: 1.125rem; /* 18px */
            color: #334155;
            max-width: 350px;
            line-height: 1.7;
        }
        
        /* 3. Guardas (Endpapers) */
        .page-content.guard-page {
            background-color: #e0e7ff; /* Color lila pálido */
            background-image: var(--guard-texture);
            opacity: 0.6;
        }
        
        /* 4. Contraportada (Reflexión) */
        .reflection-box {
            position: absolute;
            bottom: 1.5rem;
            left: 1.5rem;
            right: 1.5rem;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            padding: 1rem 1.25rem;
            border-radius: 8px;
            color: #f1f5f9;
            font-style: italic;
            font-size: 0.875rem; /* 14px */
            line-height: 1.6;
        }
        
        /* --- HOTSPOT PEDAGÓGICO (El ícono llamativo) --- */
        .pedagogical-btn {
            position: absolute;
            z-index: 50;
            top: 1rem; /* 16px */
            right: 1rem; /* 16px */
            
            /* Apariencia */
            width: 40px;
            height: 40px;
            background-color: #06b6d4; /* Color Cian (Llamativo) */
            color: white;
            border: 2px solid white;
            border-radius: 50%;
            font-size: 1.5rem; /* 24px */
            font-weight: 700;
            font-family: 'Montserrat', sans-serif;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            
            /* Centrado del icono (?) */
            display: flex;
            align-items: center;
            justify-content: center;
            
            cursor: pointer;
            transition: transform 0.2s ease-out;
            
            /* Animación de Pulso (Llamativo) */
            box-shadow: 0 0 20px 5px rgba(6, 182, 212, 0.5);
            animation: pulse-cyan 2s infinite cubic-bezier(0.66, 0, 0, 1);
        }
        
        .pedagogical-btn:hover {
            transform: scale(1.15);
        }

        /* Animación del Hotspot */
        @keyframes pulse-cyan {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(6, 182, 212, 0.7);
            }
            70% {
                transform: scale(1);
                box-shadow: 0 0 0 15px rgba(6, 182, 212, 0);
            }
            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(6, 182, 212, 0);
            }
        }
        
        /* --- MODAL PEDAGÓGICO (Ventana de explicación) --- */
        #pedagogicalModal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(8px);
            z-index: 2000;
            display: none; /* Oculto por defecto */
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 1.5rem 2rem;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            border-top: 5px solid #06b6d4; /* Acento cian */
        }
        .modal-content h2 {
            font-family: 'Cinzel', serif;
            font-size: 1.75rem; /* 28px */
            color: #1e293b;
            margin-bottom: 0.75rem;
        }
        .modal-content p {
            font-family: 'Lora', serif;
            font-size: 1rem; /* 16px */
            color: #334155;
            line-height: 1.7;
            margin-bottom: 1.5rem;
        }
        .modal-content button {
            width: 100%;
            background: #334155;
            color: white;
            padding: 0.75rem;
            border-radius: 8px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            transition: background 0.2s;
        }
        .modal-content button:hover {
            background: #1e293b;
        }


        /* --- CONTROLES DE NAVEGACIÓN --- */
        .controls-bar {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            display: flex;
            gap: 1rem;
            align-items: center;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            padding: 0.5rem 1.5rem;
            border-radius: 99px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>

    <!-- 1. El Libro (Contenedor HTML vacío que llenará JS) -->
    <div class="wrapper">
        <div id="book">
            <!-- Las páginas se generan aquí por JavaScript -->
        </div>
    </div>

    <!-- 2. Barra de Controles (Navegación) -->
    <div class="controls-bar">
        <button onclick="flipPrev()" class="p-2 rounded-full hover:bg-gray-200 transition"><i class="ph-bold ph-caret-left text-xl text-gray-800"></i></button>
        <span id="pageIndicator" class="text-xs font-bold text-gray-500 uppercase tracking-widest w-24 text-center">Portada</span>
        <button onclick="flipNext()" class="p-2 rounded-full hover:bg-gray-200 transition"><i class="ph-bold ph-caret-right text-xl text-gray-800"></i></button>
    </div>

    <!-- 3. Modal de Inicio (Bienvenida) -->
    <div id="startModal" class="fixed inset-0 bg-black/80 z-[2000] flex items-center justify-center p-4">
        <div class="bg-white rounded-lg p-6 max-w-sm w-full text-center shadow-2xl">
            <h2 class="text-3xl font-serif font-bold mb-2 text-slate-800" style="font-family: 'Cinzel', serif;">Libro Álbum</h2>
            <p class="text-sm text-gray-600 mb-6">Una experiencia pedagógica interactiva.</p>
            <button onclick="startExperience()" class="w-full bg-cyan-600 text-white py-2 rounded font-bold hover:bg-cyan-700 transition">Comenzar</button>
        </div>
    </div>
    
    <!-- 4. Modal Pedagógico (Oculto por defecto) -->
    <div id="pedagogicalModal">
        <div class="modal-content">
            <h2 id="modalTitle">Título de la Sección</h2>
            <p id="modalText">Explicación de la parte del libro...</p>
            <button id="closeModalBtn">Entendido</button>
        </div>
    </div>

    <script>
        let pageFlip; // Variable global para el objeto del libro
        
        // URLs de imágenes (Placeholders para libro álbum)
        // Usamos Unsplash con "seed" para obtener imágenes variadas pero consistentes
        const IMG_URL = 'https://source.unsplash.com/800x1200?';
        const IMG_PORTADA = IMG_URL + 'fantasy,illustration';
        const IMG_CONTRAPORTADA = IMG_URL + 'path,mystical';
        
        // --- 1. CONTENIDO DEL LIBRO (La "Fuente de Verdad") ---
        // Aquí definimos la estructura pedagógica.
        const bookContent = [
            // 1. Portada
            { 
                type: 'cover', 
                img: IMG_PORTADA, 
                hotspot: {
                    title: 'La Portada',
                    text: 'Esta es la Portada. Es la "cara" del libro y lo primero que vemos. En un libro álbum, la ilustración de la portada es clave para contarnos de qué se tratará la historia sin usar palabras.'
                }
            },
            
            // 2. Guardas (Inicio)
            { 
                type: 'guard',
                hotspot: {
                    title: 'Las Guardas',
                    text: 'Estas son las Guardas. Son las páginas (a veces dobles) que unen la tapa dura con el interior del libro. Pueden ser de un color, tener un patrón o una ilustración que nos introduce al mundo de la historia.'
                }
            },
            
            // 3. Página de Respeto (Simple)
            { type: 'respect' },
            
            // 4. Créditos
            { 
                type: 'legal', 
                title: 'Créditos Editoriales',
                text: 'Ilustraciones: Artista Ejemplo\nHistoria: Escritor Ejemplo\nDiseño: Tu Nombre Aquí\nPublicado por: Editorial Creativa, 2025\nHecho en Colombia',
                hotspot: {
                    title: 'Página de Créditos',
                    text: 'Esta es la página de Créditos o página legal. Aquí se lista quiénes hicieron el libro (autor, ilustrador, editorial) y la información de publicación, como el año y el país.'
                }
            },
            
            // 5. Dedicatoria
            { 
                type: 'dedication', 
                text: 'A todos los que se atreven a soñar con mundos dibujados.',
                hotspot: {
                    title: 'La Dedicatoria',
                    text: 'Esta es la Dedicatoria. Es un espacio corto y elegante donde el autor o ilustrador le ofrece su obra a una persona o grupo especial en su vida.'
                }
            },
            
            // --- 6 a 19. Cuerpo del Libro (14 páginas) ---
            // Generamos 14 páginas de cuerpo.
            ...Array.from({ length: 14 }, (v, i) => ({
                type: 'body',
                img: `${IMG_URL}dream,illustration,${i}`, // Imagen única para cada página
                // El hotspot solo se añade a la PRIMERA página del cuerpo
                hotspot: i === 0 ? { 
                    title: 'Páginas de Cuerpo',
                    text: 'Estas son las Páginas de Cuerpo. En un libro álbum, aquí es donde la historia se cuenta visualmente. Las ilustraciones ocupan toda la página y son las protagonistas.'
                } : null
            })),

            // 20. Guardas (Final)
            { type: 'guard' },
            
            // 21. Contraportada
            { 
                type: 'cover-back', 
                img: IMG_CONTRAPORTADA,
                reflection: 'Las mejores historias no terminan en la última página, sino que comienzan en tu imaginación.',
                hotspot: {
                    title: 'La Contraportada',
                    text: 'Esta es la Contraportada. Es la parte de atrás del libro. A menudo tiene un pequeño texto o reflexión final que te deja pensando sobre la historia que acabas de ver.'
                }
            }
        ];

        // --- 2. FUNCIONES DEL LIBRO ---

        function startExperience() {
            document.getElementById('startModal').style.display = 'none';
            initBook();
        }

        // Calcula las dimensiones óptimas del libro para la pantalla
        function calculateBookDimensions() {
            const wrapper = document.querySelector('.wrapper');
            const winWidth = wrapper.clientWidth;
            const winHeight = wrapper.clientHeight;

            const verticalMargin = 60; // Margen vertical total (arriba/abajo)
            const horizontalMargin = 40; // Margen lateral total

            const availableHeight = winHeight - verticalMargin;
            const availableWidth = winWidth - horizontalMargin;

            // Relación de aspecto de una página de libro álbum (más vertical)
            const aspectRatio = 0.75; // Ancho / Alto (Ej: 800 ancho / 1066 alto)

            let bookHeight = availableHeight;
            let bookWidth = bookHeight * aspectRatio;

            const isMobile = winWidth < 768;
            const pagesVisible = isMobile ? 1 : 2;

            if ((bookWidth * pagesVisible) > availableWidth) {
                bookWidth = availableWidth / pagesVisible;
                bookHeight = bookWidth / aspectRatio;
            }

            return { width: Math.floor(bookWidth), height: Math.floor(bookHeight) };
        }

        // Inicializa el libro: genera el HTML y carga PageFlip
        function initBook() {
            const bookEl = document.getElementById('book');
           
            // 1. Generar HTML del libro desde el array `bookContent`
            let html = bookContent.map((page, i) => {
                let content = '';
                let pageClasses = 'page';
                let contentClasses = 'page-content';
                let style = '';

                // Asignar clases de Tapa Dura
                if (page.type === 'cover' || page.type === 'cover-back') {
                    pageClasses += ' hard';
                }

                // Renderizar contenido según el tipo de página
                switch (page.type) {
                    case 'cover':
                    case 'body':
                        style = `background-image: url('${page.img}');`;
                        break;
                    case 'cover-back':
                        style = `background-image: url('${page.img}');`;
                        content = `<div class="reflection-box">${page.reflection}</div>`;
                        break;
                    case 'guard':
                        contentClasses += ' guard-page';
                        break;
                    case 'respect':
                        contentClasses += ' bg-gray-50'; // Página en blanco simple
                        break;
                    case 'legal':
                        contentClasses += ' legal-page';
                        content = `<div class="legal-box">
                                       <h2>${page.title}</h2>
                                       <p>${page.text}</p>
                                   </div>`;
                        break;
                    case 'dedication':
                        contentClasses += ' dedication-page';
                        content = `<p>${page.text}</p>`;
                        break;
                }
                
                // Añadir el Hotspot Pedagógico si existe en la página
                if (page.hotspot) {
                    content += renderHotspot(page.hotspot);
                }

                return `<div class="${pageClasses}" style="${style}">
                            <div class="${contentClasses}">${content}</div>
                        </div>`;
            }).join('');
           
            bookEl.innerHTML = html;

            // 2. Calcular dimensiones e inicializar PageFlip
            const dims = calculateBookDimensions();
           
            pageFlip = new St.PageFlip(bookEl, {
                width: dims.width,
                height: dims.height,
                size: 'fixed', // Usamos 'fixed' porque calculamos nosotros el tamaño
                minWidth: 200, maxWidth: 1200,
                minHeight: 300, maxHeight: 1600,
                maxShadowOpacity: 0.5,
                showCover: true,
                mobileScrollSupport: false // Desactivamos scroll para usar el gesto de flip
            });

            pageFlip.loadFromHTML(document.querySelectorAll('.page'));

            // 3. Añadir Listeners (eventos)
            pageFlip.on('flip', (e) => {
                updatePageIndicator(e.data);
            });
            
            // Actualizar indicador al inicio
            updatePageIndicator(0);
            
            // Conectar botones del modal
            attachHotspotEvents();
        }

        // --- 3. FUNCIONES DE HOTSPOT Y MODAL ---
        
        // Genera el HTML para el botón del hotspot
        function renderHotspot(hotspot) {
            // Escapamos comillas simples para que no rompan el HTML
            const title = hotspot.title.replace(/'/g, "\\'");
            const text = hotspot.text.replace(/'/g, "\\'");
            
            // El onclick llama a la función del modal
            return `<button 
                        class="pedagogical-btn" 
                        onclick="showPedagogicalModal('${title}', '${text}')"
                    >?</button>`;
        }
        
        // Asigna el evento al botón de "Cerrar" del modal
        function attachHotspotEvents() {
            document.getElementById('closeModalBtn').onclick = hidePedagogicalModal;
            
            // Cierra el modal si se hace clic fuera del contenido
            document.getElementById('pedagogicalModal').onclick = (e) => {
                if (e.target.id === 'pedagogicalModal') {
                    hidePedagogicalModal();
                }
            };
        }
        
        // Muestra el modal con el contenido pedagógico
        function showPedagogicalModal(title, text) {
            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalText').innerText = text;
            document.getElementById('pedagogicalModal').style.display = 'flex';
        }
        
        // Oculta el modal
        function hidePedagogicalModal() {
            document.getElementById('pedagogicalModal').style.display = 'none';
        }

        // --- 4. FUNCIONES DE NAVEGACIÓN (UI) ---

        function flipNext() { if (pageFlip) pageFlip.flipNext(); }
        function flipPrev() { if (pageFlip) pageFlip.flipPrev(); }
        
        // Actualiza el texto del indicador de página (Ej: "Pág 2-3")
        function updatePageIndicator(currentPage) {
            const indicator = document.getElementById('pageIndicator');
            const total = pageFlip.getPageCount();
            
            if (currentPage === 0) {
                indicator.innerText = 'Portada';
            } else if (currentPage >= total - 2) { // Última página (contraportada)
                indicator.innerText = 'Final';
            } else {
                let left = currentPage;
                let right = currentPage + 1;
                if (left % 2 !== 0) { // Si estamos en una página derecha
                    left = currentPage - 1;
                    right = currentPage;
                }
                if (left === 0) left = 1; // Evitar mostrar "Pág 0-1"
                
                // En móvil, PageFlip muestra de a una
                if (window.innerWidth < 768) {
                    indicator.innerText = `Pág ${currentPage}`;
                } else {
                     indicator.innerText = `Pág ${left}-${right}`;
                }
            }
        }

        // --- 5. MANEJO DE REDIMENSIONAMIENTO DE VENTANA ---
        
        // Recalcular si se redimensiona la ventana (ej: girar el móvil)
        let resizeTimeout;
        window.onresize = () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                if (pageFlip) {
                    // Destruimos la instancia anterior y la creamos de nuevo
                    // con las nuevas dimensiones.
                    pageFlip.destroy();
                    initBook(); 
                }
            }, 300); // Espera 300ms antes de recalcular
        };

    </script>
</body>
</html>
